(()=>{"use strict";var e={849:(e,t,i)=>{i.r(t)},985:(e,t,i)=>{i.r(t)},496:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;class i{static setConfig({width:e,height:t}){i.width=e,i.height=t,i.partSize=t/20}}t.Config=i},491:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0;const r=i(220),n=i(831),s=i(496);t.Field=class{constructor(e){this.cubes=[],this.lines=[],this.field=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],e&&(this.field=e.map((e=>e.map((e=>1===e?new n.FigurePart(r.Utils.getRandomColor()):e)))))}render(e){this.field.forEach(((t,i)=>{t.forEach(((t,r)=>{"number"!=typeof t&&t.render(r,i,e)}))})),this.lines.forEach(((t,i)=>{this.cubes.forEach(((i,r)=>{i.render(s.Config.width/s.Config.partSize/2-this.cubes.length/2+r,t,e)}))}))}renderRemove(e,t){this.lines=e,this.animationTimer=setInterval((()=>{if(this.cubes.push(new n.FigurePart("#ECF0F1")),this.cubes.push(new n.FigurePart("#ECF0F1")),t.render(t.game.context),this.cubes.length>11)return this.removeLines(e),this.cubes=[],this.lines=[],t.render(t.game.context),void clearInterval(this.animationTimer)}),60)}append(e){e.getTemplate().forEach(((t,i)=>{t.forEach(((t,r)=>{"number"!=typeof t&&(this.field[e.getY()+i][e.getX()+r]=t)}))}))}checkLinesFilled(e){const t=e.getTemplate();let i=[],r=!1;for(let n=0;n<t.length;n++){const t=this.field[n+e.getY()];for(let e=0;e<t.length;e++){if("number"==typeof t[e]){r=!1;break}r=!0}r&&i.push(e.getY()+n),r=!1}return i}removeLines(e){for(e.forEach((e=>{this.field[e]=[]})),this.field=this.field.filter(((e,t)=>e.length>0));this.field.length<20;)this.field.unshift([0,0,0,0,0,0,0,0,0,0])}checkFieldPartCollision(e){const t=e.getTemplate();for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if("number"!=typeof r[t]&&"number"!=typeof this.field[e.getY()+i][e.getX()+t])return!0}return!1}checkFieldBottomCollision(e){const t=e.getTemplate();return e.getY()+t.length>=this.field.length+1||!!this.checkFieldPartCollision(e)}getField(){return this.field}}},611:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=i(695),n=i(496);t.default=class{constructor(e){this.configureCanvas(e),this.screen=new r.MenuScreen(this),this.render(this.context),window.addEventListener("resize",(()=>{this.configureCanvas(e),this.render(this.context)})),window.addEventListener("keydown",this.keyPressed.bind(this))}configureCanvas(e){this.canvas=e,this.context=e.getContext("2d"),this.context.translate(.5,.5),n.Config.setConfig({width:window.innerHeight/20*10,height:window.innerHeight}),this.canvas.width=n.Config.width,this.canvas.height=n.Config.height}render(e){this.screen.render(e)}setScreen(e){this.screen=e}keyPressed(e){this.screen.keyPressed(e),this.screen.render(this.context)}}},601:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.KeyType=void 0,(i=t.KeyType||(t.KeyType={})).RIGHT="ArrowRight",i.LEFT="ArrowLeft",i.UP="ArrowUp",i.DOWN="ArrowDown",i.ENTER="Enter"},220:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;const r=i(831);class n{static getRandomFigure(){return r.FigureType[n.getRandom(0,r.FigureType.length-1)]}static getRandom(e,t){return Math.round(e+Math.random()*t)}static getRandomColor(){const e=["#e53935","#8e24aa","#3949ab","#039be5","#43a047","#c0ca33","#ffb300","#f4511e","#546e7a","#9CCC65","#1565C0","#F06292","#B388FF","#82B1FF","#FF6D00"];return e[n.getRandom(0,e.length-1)]}static templateToFigure(e,t){return t.map((t=>t.map((t=>0!==t?new r.FigurePart(e):t))))}static turnFigure(e){const t=[...e];let i=new Array(t[0].length).fill(0).map((e=>new Array(t.length).fill(0)));return t.forEach(((e,t)=>{e.forEach(((e,r)=>{i[r][i[0].length-t-1]=e}))})),i}static turnFigureBackward(e){const t=[...e];let i=new Array(t[0].length).fill(0).map((e=>new Array(t.length).fill(0)));return t.forEach(((e,t)=>{e.forEach(((e,r)=>{i[i.length-r-1][t]=e}))})),i}static invertColor(e){let t=e;return t=t.substring(1),t=parseInt(t,16),t^=16777215,t=t.toString(16),t=("000000"+t).slice(-6),t="#"+t,t}}t.Utils=n},892:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=i(220),n=i(496);t.default=class{constructor(e,t){this.template=r.Utils.templateToFigure(e,t),this.x=n.Config.width/n.Config.partSize/2-Math.round(t[0].length/2),this.y=0}render(e){this.template.forEach(((t,i)=>{t.map(((t,r)=>{"number"!=typeof t&&t.render(r+this.x,i+this.y,e)}))}))}turn(){this.template=r.Utils.turnFigure(this.template)}turnBackward(){this.template=r.Utils.turnFigureBackward(this.template)}moveDown(){this.y++}moveLeft(){this.x--}moveRight(){this.x++}getX(){return this.x}getY(){return this.y}setX(e){this.x=e}setY(e){this.y=e}getTemplate(){return this.template}}},996:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=i(496);t.default=class{constructor(e,t){this.color=e,this.y=t}render(e,t,i){const n=e*r.Config.partSize,s=n+r.Config.partSize,o=t*r.Config.partSize,l=o+r.Config.partSize,h=1.75;i.fillStyle=this.color,i.fillRect(e*r.Config.partSize,t*r.Config.partSize,r.Config.partSize,r.Config.partSize),i.beginPath(),i.lineWidth=3.5,i.strokeStyle="#00000022",this.drawLine(s-h,o,s-h,l,i),this.drawLine(n,l-h,s,l-h,i),i.stroke(),i.beginPath(),i.lineWidth=3.5,i.strokeStyle="#ffffffbb",this.drawLine(n,o+h,s,o+h,i),this.drawLine(n+h,o,n+h,l,i),i.stroke()}drawLine(e,t,i,r,n){n.moveTo(e,t),n.lineTo(i,r)}}},366:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[[[1,1,1,1]],[[0,1],[0,1],[1,1]],[[1,0],[1,0],[1,1]],[[1,1],[1,1]],[[1,0],[1,1],[0,1]],[[1,0],[1,1],[1,0]],[[0,1],[1,1],[1,0]]]},831:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FigureType=t.FigurePart=t.Figure=void 0;var n=i(892);Object.defineProperty(t,"Figure",{enumerable:!0,get:function(){return r(n).default}});var s=i(996);Object.defineProperty(t,"FigurePart",{enumerable:!0,get:function(){return r(s).default}});var o=i(366);Object.defineProperty(t,"FigureType",{enumerable:!0,get:function(){return r(o).default}})},989:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(611));t.default=n.default},994:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(987)),s=r(i(284)),o=i(491),l=i(496),h=i(601),a=i(220);class u extends n.default{constructor(e){super(e),this.index=0,this.menu=["Start","Options","About","Github"],this.fieldTemplate=[[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,1,1],[1,1,1,0,0,0,0,1,1,1],[1,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,1,1],[1,1,1,0,0,0,0,1,1,1],[1,1,1,1,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1]],this.field=new o.Field(this.fieldTemplate),this.color=a.Utils.getRandomColor(),this.menuColor=a.Utils.invertColor(this.color)}render(e){const t=5*l.Config.height/100;e.fillStyle=this.color,e.fillRect(0,0,l.Config.width,l.Config.height),this.field.render(e),e.fillStyle="#fff",e.font=`${t}px sans-serif`,e.textBaseline="top",e.textAlign="center",this.menu.forEach(((i,r)=>{r!==this.index&&e.fillText(i,l.Config.width/2,l.Config.height/2-this.menu.length/2*t+r*t)})),e.fillStyle=this.menuColor,e.fillText(this.menu[this.index],l.Config.width/2,l.Config.height/2-this.menu.length/2*t+this.index*t)}select(){switch(this.menu[this.index]){case"Start":const e=new s.default(this.game);e.start(),this.game.setScreen(e);break;case"Options":case"About":alert("SOON");break;case"Github":window.open("https://github.com/scrolis/tetris-game","_blank")}}keyPressed(e){switch(e.key){case h.KeyType.UP:this.index--,this.index<0&&(this.index=this.menu.length-1);break;case h.KeyType.DOWN:this.index++,this.index>this.menu.length-1&&(this.index=0);break;case h.KeyType.ENTER:this.select()}}}t.default=u},987:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.game=e}}},284:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(987)),s=i(220),o=i(491),l=i(831),h=i(496),a=i(601);class u extends n.default{constructor(e){super(e),this.field=new o.Field,this.figure=new l.Figure(s.Utils.getRandomColor(),s.Utils.getRandomFigure())}render(e){e.fillStyle="#ffafaf",e.fillRect(0,0,h.Config.width,h.Config.height),this.figure.render(e),this.field.render(e),this.renderGrid(e)}renderGrid(e){e.strokeStyle="#000000",e.lineWidth=.2;for(let t=0;t<=h.Config.width/h.Config.partSize;t++)e.beginPath(),e.moveTo(t*h.Config.partSize,0),e.lineTo(t*h.Config.partSize,h.Config.height),e.stroke();for(let t=0;t<=h.Config.height/h.Config.partSize;t++)e.beginPath(),e.moveTo(0,t*h.Config.partSize),e.lineTo(h.Config.width,t*h.Config.partSize),e.stroke()}keyPressed(e){switch(e.key){case a.KeyType.LEFT:this.figure.moveLeft(),(this.figure.getX()<0||this.field.checkFieldPartCollision(this.figure))&&this.figure.setX(this.figure.getX()+1);break;case a.KeyType.RIGHT:this.figure.moveRight(),(this.figure.getX()+this.figure.getTemplate()[0].length-1>this.field.getField()[0].length-1||this.field.checkFieldPartCollision(this.figure))&&this.figure.setX(this.figure.getX()-1);break;case a.KeyType.UP:this.turnFigure();break;case a.KeyType.DOWN:this.moveDown()}}moveDown(){if(this.figure.moveDown(),this.field.checkFieldBottomCollision(this.figure)){this.figure.setY(this.figure.getY()-1),this.field.append(this.figure);const e=this.field.checkLinesFilled(this.figure);e.length&&!this.field.cubes.length&&this.field.renderRemove(e,this),this.figure=new l.Figure(s.Utils.getRandomColor(),s.Utils.getRandomFigure()),this.field.checkFieldBottomCollision(this.figure)&&this.stop()}this.render(this.game.context)}turnFigure(){this.figure.turn(),this.field.checkFieldPartCollision(this.figure)&&this.figure.turnBackward()}gamePlay(){this.moveDown()}stop(){console.log("STOP"),clearInterval(this.gameTimer)}pause(){clearInterval(this.gameTimer)}start(){this.gameTimer=setInterval(this.gamePlay.bind(this),1e3)}}t.default=u},695:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TetrisScreen=t.MenuScreen=t.Screen=void 0;var n=i(987);Object.defineProperty(t,"Screen",{enumerable:!0,get:function(){return r(n).default}});var s=i(994);Object.defineProperty(t,"MenuScreen",{enumerable:!0,get:function(){return r(s).default}});var o=i(284);Object.defineProperty(t,"TetrisScreen",{enumerable:!0,get:function(){return r(o).default}})},607:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(989));i(849),i(985);const s=document.getElementById("canvas");new n.default(s)}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(607)})();